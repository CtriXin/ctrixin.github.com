<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>小浪游戏</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!--<link rel="shortcut icon" href="/favicon.ico">-->


    <link rel="stylesheet" href="http://auv2.game.weibo.cn/auv/api/server/platform/css/v2_0_1/sm.min.css">
    <link rel="stylesheet" href="http://auv2.game.weibo.cn/auv/api/server/platform/css/v2_0_1/sm-extend.min.css">
    <link rel="stylesheet" href="http://auv2.game.weibo.cn/auv/api/server/platform/css/v2_0_1/style.css">
    <link rel="stylesheet" href="http://auv2.game.weibo.cn/auv/api/server/platform/fonts/v2_0_1/iconfont.css">
</head>
<body>


<div class="page-group">
    <div id="page-rank" class="page">
        <header class="bar rank-nav bar-nav">
            <a class="button button-link button-top-back pull-left back">
                <i class="icon iconfont icon-backleft"></i>
            </a>
            <h1 class="title">游戏成绩</h1>
        </header>


        <div class="content auto">
            <div class="list-block rank-list-header media-list">
                <ul>
                    <a href="#" class="item-content toprank">
                        <div class="item-media item-img-group trapezoid">
                            <img src="" class="tranp">
                        </div>
                        <div class="item-inner">
                            <div class="item-title-row">
                                <div class="item-title">这里是游戏名称</div>
                            </div>
                            <div class="item-subtitle">人气: 999999 &nbsp;<span class="game-rank">当前: 99</span></div>
                        </div>
                        <div class="item-media right-nav">
                            <i class="icon iconfont icon-icon10"></i>
                        </div>

                    </a>
                </ul>
            </div>




            <div class="buttons-tab  fixed-tab rank-pannel" data-offset="24">
                <a href="#tab1" class="tab-link active button day">日榜</a>
                <a href="#tab2" class="tab-link button week">周榜</a>
                <a href="#tab3" class="tab-link button month">月榜</a>
            </div>
            <div class="content-block inner-rank">
                <div class="tabs">
                    <div id="tab1" class="tab active">
                        <div class="list-block modal-list-header media-list">
                            <ul>
                                <li>
                                    <a href="#" class="item-content">
                                        <div class="item-media item-img-group">
                                            <img src="" class="item-round my-score-rank" >
                                            <span class="badge item-badgt">332323232</span>
                                        </div>
                                        <div class="item-inner">
                                            <div class="item-title title-name">发达放到萨芬</div>
                                            <div class="item-subtitle subtitle-score">最高得分: 699999</div>
                                            <div class="item-subtitle subtitle-phone-number">距第一名还差: <span>99999</span></div>

                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>


                        <!--下面的排行榜-->
                        <div class="list-block modal-list-body media-list modal-list-body1">

                        </div>

                    </div>
                    <div id="tab2" class="tab">
                        <div class="list-block modal-list-header media-list">
                            <ul>
                                <li>
                                    <a href="#" class="item-content">
                                        <div class="item-media item-img-group">
                                            <img src="" class="item-round my-score-rank" >
                                            <span class="badge item-badgt">332323232</span>
                                        </div>
                                        <div class="item-inner">
                                            <div class="item-title title-name">发达放到萨芬</div>
                                            <div class="item-subtitle subtitle-score">最高得分: 699999</div>
                                            <div class="item-subtitle subtitle-phone-number">距第一名还差: <span>99999</span></div>

                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>


                        <!--下面的排行榜-->
                        <div class="list-block modal-list-body media-list modal-list-body2">

                        </div>
                    </div>
                    <div id="tab3" class="tab">
                        <div class="list-block modal-list-header media-list">
                            <ul>
                                <li>
                                    <a href="#" class="item-content">
                                        <div class="item-media item-img-group">
                                            <img src="" class="item-round my-score-rank" >
                                            <span class="badge item-badgt">332323232</span>
                                        </div>
                                        <div class="item-inner">
                                            <div class="item-title title-name">发达放到萨芬</div>
                                            <div class="item-subtitle subtitle-score">最高得分: 699999</div>
                                            <div class="item-subtitle subtitle-phone-number">距第一名还差: <span>99999</span></div>

                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>


                        <!--下面的排行榜-->
                        <div class="list-block modal-list-body media-list modal-list-body3">

                        </div>
                    </div>
                </div>
            </div>






        </div>
    </div>


    <p><a href="javascript:;" class="close-popup">Close popup</a></p>
</div>


<script type='text/javascript' src='http://auv2.game.weibo.cn/auv/api/server/platform/js/v2_0_1/zepto.min.js'></script>
<script type='text/javascript' src='http://auv2.game.weibo.cn/auv/api/server/platform/js/v2_0_1/sm.js' charset='utf-8'></script>
<script type='text/javascript' src='http://auv2.game.weibo.cn/auv/api/server/platform/js/v2_0_1/sm-extend.min.js' charset='utf-8'></script>
<script type="text/javascript" src="http://auv2.game.weibo.cn/auv/api/server/platform/js/v2_0_1/modify.js"></script>

</body>
<script>


    $(function () {
        showRankPop(getCookieByName("suid"),getCookieByName("gameappkey"),"1");
        showGameInfo(getCookieByName("gameappkey"));
        $('.day').click(function(){
            showRankPop(getCookieByName("suid"),getCookieByName("gameappkey"),"1");
        });
        $('.week').click(function(){
            showRankPop(getCookieByName("suid"),getCookieByName("gameappkey"),"2");
        });
        $('.month').click(function(){
            showRankPop(getCookieByName("suid"),getCookieByName("gameappkey"),"3");
        });
    });

    /* 显示游戏详细信息 */
    showGameInfo = function (gameappkey) {
        //修改密码
        var postData = "gameappkey=" + gameappkey;

        var gameInfo = new XMLHttpRequest();
        gameInfo.open("GET", "http://auv2.game.weibo.cn/auv/api/server/platform/index.php/WxGame/get_alone_game?" + postData, true);
        gameInfo.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        gameInfo.onreadystatechange = function () {
            if (gameInfo.readyState == 4 && gameInfo.status == 200) {
                var jsObj = JSON.parse(gameInfo.responseText);
                if (jsObj.status == 0) {
                    //刷新数据
                    $('.toprank').find('.item-title').html(jsObj.game_name);
                    $('.toprank').find('.item-subtitle').html("人气:" + jsObj.user_num);
                    $('.game-rank').html("当前:" + jsObj.rank);
                    $('.tranp').attr('src',jsObj.icon);
                }
            }
        }

        gameInfo.send();
    };

    /* 显示排行榜 */
    showRankPop = function (suid,gameappkey,rank_type) {
        //屏蔽触摸
        $.showIndicator();
        //修改密码
        var postData = "suid=" + suid;
        postData += "&gameappkey=" + gameappkey;
        postData += "&state=" + rank_type;//榜单类型 1 日榜 2 周榜 3 月榜

        var change_rank = "modal-list-body" + rank_type;

        var rankList = new XMLHttpRequest();
        rankList.open("POST", "http://auv2.game.weibo.cn/auv/api/server/platform/index.php/WxGame/alone_game_list", true);
        rankList.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        rankList.onreadystatechange = function () {
            if (rankList.readyState == 4 && rankList.status == 200) {
                $.hideIndicator();
                $('.' + change_rank).find('.item-content').remove();
                var jsObj = JSON.parse(rankList.responseText);
                if (jsObj.status == 0) {
                    //刷新数据
                    $('.modal-list-header').find('img').attr('src', jsObj.my_icon);
                    $('.modal-list-header').find('.title-name').html(jsObj.my_name);
                    $('.modal-list-header').find('.subtitle-score').html("最高得分:" + jsObj.integral);
                    $('.modal-list-header').find('.subtitle-phone-number').html("距离第一名:" + (jsObj.ranl_list[0].integral - jsObj.integral));
                    $('.modal-list-header').find('.item-badgt').html(jsObj.my_rank);

                    //处理数据
                    var oldSrc = $(".smallsina-icon").find("img").attr("src");
                    for (var i = 0; i < jsObj.ranl_list.length; i++) {
                        if (i < 3) {
                            jsObj.ranl_list[i].rank = "http://auv2.game.weibo.cn/auv/api/server/platform/images/v1_0_5/rank_icon_" + i + ".png";
                        }
                    }
                    var data = jsObj.ranl_list;
                    for (var i in data) {
                        if (i < 3) {
                            $('.' + change_rank).append(
                                    '<ul> ' +
                                    '<li> ' +
                                    '<a href="#" class="item-content"> ' +
                                    '<div class="item-media item-img-group"> ' +
                                    '<img src="' + data[i].icon + '" class="item-round ranking-score-img" > ' +
                                    '<span class="img-badgt"><img src="' + data[i].rank + '" alt=""></span> ' +
                                    '</div> ' +
                                    '<div class="item-inner"> ' +
                                    '<div class="item-title title-name">'+ data[i].name +'</div> ' +
                                    '<div class="item-subtitle subtitle-score">' + '最高得分:'+ data[i].integral + '</div> ' +
                                    '<div class="item-subtitle subtitle-phone-number"> '+ data[i].suid + '</div> ' +
                                    '</div>'+
                                    '<div class="item-media right-score-he-get">' +
                                    '<p>' + '获得积分' + '<br><span>' + data[i].integral + '</span></p>' +
                                    '</div> ' +
                                    '</a> ' +
                                    '</li> </ul>'
                            )
                        } else {
                            $('.' + change_rank).append(
                                    '<ul> ' +
                                    '<li> ' +
                                    '<a href="#" class="item-content"> ' +
                                    '<div class="item-media item-img-group"> ' +
                                    '<img src="' + data[i].icon + '" class="item-round ranking-score-img" > ' +
                                    '<span class="badge item-badgt">' + data[i].rank + '</span> ' +
                                    '</div> ' +
                                    '<div class="item-inner"> ' +
                                    '<div class="item-title title-name">'+ data[i].name +'</div> ' +
                                    '<div class="item-subtitle subtitle-score">' + '最高得分:'+ data[i].integral + '</div> ' +
                                    '<div class="item-subtitle subtitle-phone-number">'+ data[i].suid + '</div> ' +
                                    '</div>'+
                                    '<div class="item-media right-score-he-get">' +
                                    '<p>' + '获得积分' + '<br><span>' + data[i].integral + '</span></p>' +
                                    '</div> ' +
                                    '</a> ' +
                                    '</li> </ul>'
                            )
                        }

                    }

                    //显示排行榜
                    $.popup('.popup-rank');


//                    console.log("显示排行榜");
                } else {
                    //不显示排行榜
//                    console.log("不显示排行榜");
                }
            }
        }

        rankList.send(postData);
    };



    /* 根据名字取得cookie */
    getCookieByName = function (cookieName) {
        var strCookie = document.cookie;
        var dataList = strCookie.split(";");
        for(var i = 0 ; i < dataList.length;i++){
            var index = dataList[i].indexOf(cookieName)
            if(index > -1){
                index = dataList[i].indexOf("=");
                return dataList[i].substring(index + 1, dataList[i].length);
            }
        }
        return "";
    };
</script>
</html>