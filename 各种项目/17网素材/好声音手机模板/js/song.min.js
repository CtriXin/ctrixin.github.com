//feifanli@sohu-inc.com
function showSec(a,b){var c,d,e,f=$(".section").length;"next"==b?(c=a==f?1:a+1,d=c==f?1:c+1,e=a):"prev"==b?(c=1==a?f:a-1,d=a,e=1==c?f:c-1):(c=a,d=a==f?1:a+1,e=1==a?f:a-1);var g=$(".sec"+c),h=$(".sec"+d),i=$(".sec"+e);if(2===c&&"string"!=typeof $(".sec2 .i-inner img").attr("style")){var j=new Image;j.src="./img/sec2_bg.jpg",j.onload=function(){var a=$(".sec2 .i-inner").width(),b=$(".sec2 .i-inner").height(),c=$(".sec2 .i-inner img");a/b>this.width/this.height?c.css("height",b):c.css("width",a),c[0].style.visibility="visible",$(".sec2 .w-inner")[0].style.visibility="visible"}}g.addClass("current"),h.addClass("next").css("-webkit-transform","translate3d(0,100%,0)"),i.addClass("prev").css("-webkit-transform","translate3d(0,-100%,0)"),g.addClass("ani").siblings(".section").removeClass("ani")}function getNumber(){setTimeout(function(){$.each($(".code li"),function(a){$(".code li").eq(a).addClass("n"+fireCode.charAt(a))})},3700)}function shareFriend(){var a=JSON.parse(JSON.stringify(wxData));WeixinJSBridge.invoke("sendAppMessage",a)}function shareTimeline(){var a=JSON.parse(JSON.stringify(wxData));a.title=a.desc,WeixinJSBridge.invoke("shareTimeline",a,function(){ClickTrace.pingback(null,"sohuSingMySongShareFromWx"),$(".share-mask").hide(),6==$(".section").index(".current")&&($(".current,.next,.prev").css({"-webkit-transition":null,"-webkit-transform":null}).removeClass("current prev next"),showSec(7,"next"))})}function chkJSB(){"undefined"!=typeof WeixinJSBridge?(WeixinJSBridge.on("menu:share:appmessage",function(){shareFriend()}),WeixinJSBridge.on("menu:share:timeline",function(){shareTimeline()}),WeixinJSBridge.on("menu:general:share",function(a){var b=JSON.parse(JSON.stringify(wxData));if("timeline"==a.shareTo){var c=b.title;b.title=b.desc,b.desc=c}a.generalShare(b)})):setTimeout(chkJSB,300)}var getQueryString=function(a){var b=new RegExp("(^|&?)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!==c?unescape(c[2]):null},inAndroidApp=$.os.android&&getQueryString("clientType")&&"1"===getQueryString("startClient")?!0:!1,inIosApp=$.os.ios&&getQueryString("clientType")&&"iphone"==getQueryString("clientType").toLowerCase()?!0:!1;inAndroidApp&&($("body").addClass("android-app"),$(window).on("resize",function(){$("html,body,#loading").css("height",window.screen.height-5+"px")}).trigger("resize")),inIosApp&&($("body").addClass("ios-app"),$(".music").hide(),window.screen.height<=480&&$("body").addClass("small")),$.os.ios&&$.os.version>=8&&3==window.devicePixelRatio&&$("body").addClass("ip6-plus");var fireCode="000000",codeBox=$(".sec7 .code")[0];$.getJSON("http://wx.m.tv.sohu.com/activity/stats/pv.json?key=singmysongact&callback=?",function(a){if(a&&a.pv){fireCode="";for(var b=0;b<6-String(a.pv).length;b++)fireCode+="0";fireCode+=String(a.pv),wxData.desc="\u6211\u5728\u641c\u72d0\u89c6\u9891\u770b\u4e2d\u56fd\u597d\u6b4c\u66f2\uff01\u6211\u662f\u7b2c"+fireCode+"\u4f4d\u539f\u521b\u97f3\u4e50\u652f\u6301\u8005\uff01",inAndroidApp&&(document.title="\u641c\u72d0\u89c6\u9891\u72ec\u64ad\u4e2d\u56fd\u597d\u6b4c\u66f2\uff01\u6211\u662f\u7b2c"+fireCode+"\u4f4d\u539f\u521b\u97f3\u4e50\u652f\u6301\u8005\uff01"),inIosApp&&(document.title=wxData.desc)}});var audioFirstPlay=!0,startX,startY,distance,timer=null;$(".section").on("touchstart",function(a){var b=$(".section").index($(this))+1,c=a.touches[0];distance=0,startY=c.clientY;var d=$(this).offset().top;if(!$(".next").length||!$(".prev").length||timer)return a.preventDefault(),void 0;var e=$(".next").offset().top,f=$(".prev").offset().top;!inIosApp&&1==b&&oAudio.paused&&audioFirstPlay&&(oAudio.play(),oAudio.paused||$(".music").removeClass("pause"),audioFirstPlay=!1),$(this).off("touchmove").on("touchmove",function(a){var c=a.touches[0];if(distance=c.clientY-startY,Math.abs(distance)<5)return a.preventDefault(),void 0;if(1===b&&distance>0||b===$(".section").length&&0>distance)return a.preventDefault(),void 0;var g=d+distance;$(this).css("-webkit-transform","translate3d(0,"+g+"px,0)");var h=e+distance;$(".next").css({"-webkit-transform":"translate3d(0,"+h+"px,0)"});var i=f+distance;$(".prev").css({"-webkit-transform":"translate3d(0,"+i+"px,0)"}),a.preventDefault()}),$(this).off("touchend").on("touchend",function(a){if(Math.abs(distance)<5)return a.preventDefault(),void 0;if(1===b&&distance>0||b===$(".section").length&&0>distance)return a.preventDefault(),void 0;if($(".current,.next,.prev").css("-webkit-transition","-webkit-transform .3s ease-out"),-70>distance||distance>70){var c=!!(-70>distance);$(this).css("-webkit-transform","translate3d(0,"+(c?-$(this).height():$(this).height())+"px,0)"),$(c?".next":".prev").css("-webkit-transform","translate3d(0,0,0)"),timer=setTimeout(function(){$(".current,.next,.prev").css({"-webkit-transition":null,"-webkit-transform":null}).removeClass("current prev next"),showSec(b,c?"next":"prev"),clearTimeout(timer),timer=null},305)}else $(this).css("-webkit-transform","translate3d(0,0,0)"),$(".prev").css("-webkit-transform","translate3d(0,-100%,0)"),$(".next").css("-webkit-transform","translate3d(0,100%,0)"),timer=setTimeout(function(){$(".current,.next,.prev").css({"-webkit-transition":null}),clearTimeout(timer),timer=null},305);a.preventDefault()}),a.preventDefault()}),$(".btn-fire").on("touchstart",function(){return $(this).addClass("hover"),!1}),$(".btn-fire").on("touchmove",function(){return!1}),$(".btn-fire").on("touchend",function(){return $(".sec7").addClass("act"),$(this).removeClass("hover"),getNumber(),!1}),$(".share-btn").on("tap",function(){return $(".share-mask").show(),!1}),$(".share-mask").on("tap",function(){return $(".share-mask").hide(),!1}),$(".share-mask").on("touchmove",function(){return!1});var downloadAppLink=Util.getDownloadAppLink();$(".download-btn").on("tap",function(){return ClickTrace.pingback(null,"sohuSingMySongDownLoad"),setTimeout(function(){location.href=downloadAppLink},50),!1});var oAudio=new Audio,audioSrc="http://mfiles.sohu.com/tv/touch/song/ysjydysznsl.mp3";$(".music").on("tap",function(){return oAudio.paused?(oAudio.play(),$(this).removeClass("pause")):(oAudio.pause(),$(this).addClass("pause")),!1}),$("#loading").on("touchmove",function(){return!1}),window.onload=function(){inAndroidApp&&($(window).off("resize"),$("body").css("height",window.innerHeight+"px")),$("#loading").addClass("shift"),setTimeout(function(){showSec(1),$("#loading").hide(),inIosApp||(oAudio.src=audioSrc,oAudio.loop=!0,oAudio.play(),oAudio.paused||$(".music").removeClass("pause"))},2e3)},ClickTrace.pingback(null,"sohuSingMySongPv");var wxData={appid:"",img_url:"http://tv.sohu.com/upload/touch/mysong/img/wx.png",img_width:"300",img_height:"300",link:"http://tv.sohu.com/upload/touch/mysong/index.shtml",desc:"\u6211\u5728\u641c\u72d0\u89c6\u9891\u770b\u4e2d\u56fd\u597d\u6b4c\u66f2\uff01\u6211\u662f\u7b2c"+fireCode+"\u4f4d\u539f\u521b\u97f3\u4e50\u652f\u6301\u8005\uff01",title:"2015.01.02 \u6211\u4eec\u76f8\u7ea6\u641c\u72d0\u89c6\u9891\u300a\u4e2d\u56fd\u597d\u6b4c\u66f2\u300b"};chkJSB();