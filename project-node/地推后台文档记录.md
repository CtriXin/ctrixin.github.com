# 地推后台文档记录

## first of first
### Install dependencies

```
npm install
```

### Start server

```
npm start
```

## 登录

1. 在登录的时候，会验证用户名，当然前提必须是用户在数据库中存在
2. login页面将会清除session，以便登录
3. 输入完用户名密码，ajax
   - 跳转到logincheck，
   - 获取登录的数据，并将密码加密，
   - 实例化数据库，用用户名密码对比数据库，如果成功
   - 存session，里面有登录账户的信息
   - 跳转到index页面

## 添加用户

1. 渲染页面
2. post请求form表单，跳转到insertagent方法
3. 实例化各种数据库表
4. 去用户的表（account数据库）
5. 因为添加的不管是经理还是主管，必须是加V用户，也就是审核通过，所以就审核通过条件和手机号进行搜索
   - 如果非空（数据库中查到了此用户，且审核通过），获取用户的tataid，学校名字，检索的时间
     - 插库
   - 如果数据为空，报错
6. 添加完用户将会跳转到**agentlist**方法


## 用户管理（用户列表）
1. 获取session中的用户信息
   - 如果是初级经理或者高级经理，跳转到data页面
2. 获取下面搜索功能上传的cookie（如果没有则为空）
3. 如果cookie为空，则不是搜索的，则检验是什么级别，展现用户数据
   - 如果是省主管，只展示初级经理和高级经理数据
   - 如果是管理员，则列出所有人
4. 如果级别已选，且不为-1 展示
5. 如果搜索框不为空，根据搜索框的去检索
6. 对页面赋值
7. 清除cookie
### 搜索功能 **searchagent** 方法
1. 获取数据，存cookie
### 修改用户信息
1. get方法获取查询修改的用户id
2. 渲染页面
3. form表单提交修改增加的信息
#### **insertagentinfo** 插入修改后的数据
1. 获取post请求的数据
2. 实例化数据库
3. 插库
	- 如果密码为空，则只更新其他数据
   	- 如果密码有数据，首先md5加密，然后存数据库

### 冻结用户
1. 获取agentid
2. 将数据库中的用户frozen属性设为1